# Migration `20190825165238-init`

This migration has been generated by Ali Zahid at 8/25/2019, 4:52:38 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Post"("id" text NOT NULL  ,"body" text NOT NULL DEFAULT '' ,"rating" integer NOT NULL DEFAULT 1 ,"created" timestamp(3) NOT NULL  ,PRIMARY KEY ("id"))
;

CREATE TABLE "public"."Location"("id" text NOT NULL  ,"city" text NOT NULL DEFAULT '' ,"country" text NOT NULL DEFAULT '' ,PRIMARY KEY ("id"))
;

CREATE TABLE "public"."Rating"("id" text NOT NULL  ,"direction" integer NOT NULL DEFAULT 1 ,"created" timestamp(3) NOT NULL  ,"updated" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"))
;

CREATE TABLE "public"."Comment"("id" text NOT NULL  ,"body" text NOT NULL DEFAULT '' ,"created" timestamp(3) NOT NULL  ,PRIMARY KEY ("id"))
;

CREATE TABLE "public"."Conversation"("id" text NOT NULL  ,"created" timestamp(3) NOT NULL  ,"updated" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"))
;

CREATE TABLE "public"."Message"("id" text NOT NULL  ,"body" text NOT NULL DEFAULT '' ,"created" timestamp(3) NOT NULL  ,PRIMARY KEY ("id"))
;

CREATE TABLE "public"."User"("id" text NOT NULL  ,"notifications" boolean NOT NULL DEFAULT true ,"created" timestamp(3) NOT NULL  ,"updated" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"))
;

CREATE TABLE "public"."_ConversationToUser"("A" text   REFERENCES "public"."Conversation"("id") ON DELETE CASCADE,"B" text   REFERENCES "public"."User"("id") ON DELETE CASCADE)
;

ALTER TABLE "public"."Post" ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,ADD COLUMN "location" text   REFERENCES "public"."Location"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Rating" ADD COLUMN "post" text   REFERENCES "public"."Post"("id") ON DELETE SET NULL,ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Comment" ADD COLUMN "post" text   REFERENCES "public"."Post"("id") ON DELETE SET NULL,ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Message" ADD COLUMN "conversation" text   REFERENCES "public"."Conversation"("id") ON DELETE SET NULL,ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20190825165238-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,67 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("PRISMA_URL")
+}
+
+generator photonjs {
+  provider = "photonjs"
+}
+
+model Post {
+  id       String    @id @default(cuid())
+  body     String
+  comments Comment[]
+  rating   Int       @default(1)
+  ratings  Rating[]
+  user     User
+  created  DateTime  @default(now())
+}
+
+model Location {
+  id      String @id @default(cuid())
+  city    String
+  country String
+  posts   Post[]
+}
+
+model Rating {
+  id        String   @id @default(cuid())
+  direction Int      @default(1)
+  user      User
+  created   DateTime @default(now())
+  updated   DateTime @updatedAt
+}
+
+model Comment {
+  id      String   @id @default(cuid())
+  body    String
+  user    User
+  created DateTime @default(now())
+}
+
+model Conversation {
+  id       String    @id @default(cuid())
+  messages Message[]
+  users    User[]
+  created  DateTime  @default(now())
+  updated  DateTime  @updatedAt
+}
+
+model Message {
+  id      String   @id @default(cuid())
+  body    String
+  user    User
+  created DateTime @default(now())
+}
+
+model User {
+  id            String         @id @default(cuid())
+  comments      Comment[]
+  conversations Conversation[]
+  messages      Message[]
+  notifications Boolean        @default(true)
+  posts         Post[]
+  ratings       Rating[]
+  created       DateTime       @default(now())
+  updated       DateTime       @updatedAt
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20190825165238-init)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20190825165238-init'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()
```
